<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{% block title %}Computer Aid MW{% endblock %}</title>

<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

<style>
/* ===== DESKTOP (UNCHANGED) ===== */
.search-wrapper {
    display: flex;
    align-items: center;
    position: relative;
}
.search-input {
    width: 0;
    opacity: 0;
    overflow: hidden;
    margin-left: 0;
    transition: all .3s ease;
}
.search-wrapper.active .search-input {
    width: 200px;
    opacity: 1;
    margin-left: 8px;
}

/* ===== MOBILE PROFESSIONAL MENU ===== */
@media (max-width: 991px) {

    .navbar-collapse {
        padding-top: 12px;
    }

    .mobile-menu {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .mobile-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        padding: 10px 14px;
        border-radius: 8px;
        background: rgba(255,255,255,0.05);
        color: #fff;
        text-decoration: none;
    }

    .mobile-item i {
        font-size: 1rem;
        opacity: 0.9;
    }

    .mobile-item span {
        flex-grow: 1;
        margin-left: 10px;
    }

    /* SEARCH */
    .search-wrapper {
        width: 100%;
        flex-direction: column;
        align-items: stretch;
    }

    .search-input {
        width: 100%;
        max-height: 0;
        opacity: 0;
        margin-top: 0;
        transition: max-height .3s ease, opacity .3s ease;
    }

    .search-wrapper.active .search-input {
        max-height: 60px;
        opacity: 1;
        margin-top: 8px;
    }

    /* CART BADGE FIX */
    .cart-icon {
        position: relative;
    }

    .cart-badge {
        position: absolute;
        top: -6px;
        right: -10px;
        font-size: 0.7rem;
        padding: 3px 6px;
        border-radius: 50%;
    }
}
</style>
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-dark sticky-top">
<div class="container">

    <!-- LOGO -->
    <a class="navbar-brand" href="{{ url_for('home') }}">
        <img src="{{ url_for('static', filename='images/logo.png') }}" height="45">
    </a>

    <!-- TOGGLER -->
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">

        <!-- DESKTOP LEFT -->
        <ul class="navbar-nav me-auto d-none d-lg-flex">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('home') }}">
                    <i class="fas fa-home me-1"></i> Home
                </a>
            </li>
        </ul>

        <!-- MOBILE / RIGHT -->
        <div class="mobile-menu ms-lg-auto d-flex flex-column flex-lg-row align-items-lg-center gap-lg-2">

            <!-- HOME (MOBILE ONLY) -->
            <a href="{{ url_for('home') }}" class="mobile-item d-lg-none">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>

            <!-- SEARCH -->
            <div class="search-wrapper">
                <button type="button"
                        class="mobile-item"
                        id="searchToggle">
                    <i class="fas fa-search"></i>
                    <span>Search products</span>
                </button>

                <form method="GET"
                      action="{{ url_for('search') }}"
                      class="search-input">
                    <input type="search"
                           name="q"
                           class="form-control form-control-sm"
                           placeholder="Search products...">
                </form>
            </div>

            <!-- CART -->
            <a href="{{ url_for('view_cart') }}" class="mobile-item">
                <div class="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    {% if cart_count and cart_count > 0 %}
                    <span class="badge bg-danger cart-badge">
                        {{ cart_count }}
                    </span>
                    {% endif %}
                </div>
                <span>Cart</span>
            </a>

        </div>
    </div>
</div>
</nav>

<main>
{% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const toggle = document.getElementById("searchToggle");
const wrapper = document.querySelector(".search-wrapper");

toggle.addEventListener("click", e => {
    e.stopPropagation();
    wrapper.classList.toggle("active");
    wrapper.querySelector("input")?.focus();
});

document.addEventListener("click", e => {
    if (!wrapper.contains(e.target)) {
        wrapper.classList.remove("active");
    }
});
</script>

</body>
</html>
