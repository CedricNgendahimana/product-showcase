<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{% block title %}Computer Aid MW{% endblock %}</title>

<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

<style>
/* ===== DESKTOP SEARCH (UNCHANGED) ===== */
.search-wrapper {
    display: flex;
    align-items: center;
    position: relative;
}

.search-input {
    width: 0;
    opacity: 0;
    overflow: hidden;
    margin-left: 0;
    transition: all .3s ease;
}

.search-wrapper.active .search-input {
    width: 200px;
    opacity: 1;
    margin-left: 8px;
}

/* ===== MOBILE ONLY FIX ===== */
@media (max-width: 991px) {

    .navbar-collapse {
        padding-top: 12px;
    }

    /* Right-aligned vertical stack */
    .mobile-stack {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 10px;
    }

    /* Full-width buttons */
    .mobile-btn {
        width: 100%;
        text-align: left;
    }

    /* Search vertical slide */
    .search-wrapper {
        width: 100%;
        flex-direction: column;
        align-items: stretch;
    }

    .search-input {
        width: 100%;
        max-height: 0;
        opacity: 0;
        margin-left: 0;
        margin-top: 0;
        transition: max-height .3s ease, opacity .3s ease;
    }

    .search-wrapper.active .search-input {
        max-height: 60px;
        opacity: 1;
        margin-top: 6px;
    }
}
</style>
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-dark sticky-top">
<div class="container">

    <!-- LOGO -->
    <a class="navbar-brand" href="{{ url_for('home') }}">
        <img src="{{ url_for('static', filename='images/logo.png') }}" height="45">
    </a>

    <!-- TOGGLER -->
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
    </button>

    <!-- NAV -->
    <div class="collapse navbar-collapse" id="navbarNav">

        <!-- LEFT -->
        <ul class="navbar-nav me-auto">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('home') }}">
                    <i class="fas fa-home me-1"></i> Home
                </a>
            </li>
        </ul>

        <!-- RIGHT STACK -->
        <div class="mobile-stack ms-lg-auto d-flex flex-column flex-lg-row align-items-lg-center gap-lg-2">

            <!-- SEARCH -->
            <div class="search-wrapper" id="searchWrapper">
                <button class="btn btn-sm btn-outline-light mobile-btn"
                        type="button"
                        id="searchToggle">
                    <i class="fas fa-search me-2"></i> Search
                </button>

                <form method="GET"
                      action="{{ url_for('search') }}"
                      class="search-input">
                    <input type="search"
                           name="q"
                           class="form-control form-control-sm"
                           placeholder="Search products...">
                </form>
            </div>

            <!-- CART -->
            <a href="{{ url_for('view_cart') }}"
               class="nav-link text-white mobile-btn position-relative">
                <i class="fas fa-shopping-cart me-2"></i> Cart

                {% if cart_count and cart_count > 0 %}
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                    {{ cart_count }}
                </span>
                {% endif %}
            </a>

        </div>
    </div>
</div>
</nav>

<main>
{% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const toggle = document.getElementById("searchToggle");
const wrapper = document.getElementById("searchWrapper");

toggle.addEventListener("click", e => {
    e.stopPropagation();
    wrapper.classList.toggle("active");
    wrapper.querySelector("input")?.focus();
});

document.addEventListener("click", e => {
    if (!wrapper.contains(e.target)) {
        wrapper.classList.remove("active");
    }
});
</script>

</body>
</html>
